<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CK3 Character Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        input[type="text"], input[type="number"], select, textarea {
            width: 100%;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 15px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #4cae4c;
        }
        .date-box {
            display: inline-block;
            width: 30%;
            margin-right: 5%;
        }
        .date-label {
            display: block;
        }
        .collapsible {
            background-color: #e7f3fe;
            color: #0056b3;
            cursor: pointer;
            padding: 10px;
            border: none;
            text-align: left;
            outline: none;
            font-size: 16px;
            margin-top: 10px;
            border-radius: 4px;
        }
        .content {
            display: none;
            overflow: hidden;
            padding: 10px 0;
        }
        .personality-container {
            margin-top: 10px;
        }
        .personality-pool {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fafafa;
        }
        .personality-item {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background-color: #e7f3fe;
            color: #0056b3;
            border-radius: 4px;
            cursor: pointer;
        }
        .personality-item .remove {
            margin-left: 10px;
            color: red;
            cursor: pointer;
        }
        .autocomplete-suggestions {
            border: 1px solid #ccc;
            background: #fff;
            max-height: 150px;
            overflow-y: auto;
            position: absolute;
            z-index: 1000;
            width: 100%;
        }
        .autocomplete-suggestion {
            padding: 10px;
            cursor: pointer;
        }
        .autocomplete-suggestion:hover {
            background: #e9e9e9;
        }
    </style>
</head>
<body>

    <h1>CK3 Character Creator</h1>

    <label for="namespace">Namespace:</label>
    <input type="text" id="namespace" placeholder="Enter Namespace" required>

    <h2>Character Details</h2>

    <label for="name">Character Name:</label>
    <input type="text" id="name" placeholder="Enter Character Name" required>

    <label for="female">Female:</label>
    <select id="female">
        <option value="yes">Yes</option>
        <option value="no">No</option>
    </select>

    <button class="collapsible">Religion, Culture, and Dynasty ID</button>
    <div class="content">
        <label for="dynasty">Dynasty ID:</label>
        <input type="text" id="dynasty" placeholder="Enter Dynasty ID" required>

        <label for="religion">Religion:</label>
        <input type="text" id="religion" placeholder="Enter Religion" required>

        <label for="culture">Culture:</label>
        <input type="text" id="culture" placeholder="Enter Culture" required>
        <div id="culture-suggestions" class="autocomplete-suggestions"></div>
    </div>

    <button class="collapsible">Traits Selection</button>
    <div class="content">
        <label for="education-traits">Select Education Trait:</label>
        <select id="education-traits">
            <option value="">Select Trait</option>
            <option value="Education_intrigue_1">Amateurish Plotter</option>
            <option value="Education_intrigue_2">Flamboyant Trickster</option>
            <option value="Education_intrigue_3">Intricate Webweaver</option>
            <option value="Education_intrigue_4">Elusive Shadow</option>
            <option value="Education_intrigue_5">Conniving Puppetmaster</option>
            <option value="Education_diplomacy_1">Naive Appeaser</option>
            <option value="Education_diplomacy_2">Adequate Bargainer</option>
            <option value="Education_diplomacy_3">Charismatic Negotiator</option>
            <option value="Education_diplomacy_4">Grey Eminence</option>
            <option value="Education_diplomacy_5">Virtuoso Arbitrator</option>
            <option value="Education_stewardship_1">Indulgent Wastrel</option>
            <option value="Education_stewardship_2">Thrifty Clerk</option>
            <option value="Education_stewardship_3">Fortune Builder</option>
            <option value="Education_stewardship_4">Midas Touched</option>
            <option value="Education_stewardship_5">Golden Sovereign</option>
            <option value="Education_martial_1">Misguided Warrior</option>
            <option value="Education_martial_2">Tough Soldier</option>
            <option value="Education_martial_3">Skilled Tactician</option>
            <option value="Education_martial_4">Brilliant Strategist</option>
            <option value="Education_martial_5">Exalted Warlord</option>
            <option value="Education_learning_1">Conscientious Scribe</option>
            <option value="Education_learning_2">Insightful Thinker</option>
            <option value="Education_learning_3">Astute Intellectual</option>
            <option value="Education_learning_4">Mastermind Philosopher</option>
            <option value="Education_learning_5">Erudite Oracle</option>
            <option value="Education_republican_knowledge_1">Town Dweller</option>
            <option value="Education_republican_knowledge_2">Mayor Trainee</option>
            <option value="Education_republican_knowledge_3">Town Maven</option>
            <option value="Education_republican_knowledge_4">Republican Heir</option>
            <option value="Education_martial_prowess_1">Bumbling Squire</option>
            <option value="Education_martial_prowess_2">Confident Knight</option>
            <option value="Education_martial_prowess_3">Formidable Banneret</option>
            <option value="Education_martial_prowess_4">Famous Champion</option>
        </select>

        <label for="court-traits">Select Court Trait:</label>
        <select id="court-traits">
            <option value="">Select Trait</option>
            <option value="Diplomatic_court_1">Diplomatic Court 1</option>
            <option value="Diplomatic_court_2">Diplomatic Court 2</option>
            <option value="Warlike_court_1">Warlike Court 1</option>
            <option value="Warlike_court_2">Warlike Court 2</option>
            <option value="Administrative_court_1">Administrative Court 1</option>
            <option value="Administrative_court_2">Administrative Court 2</option>
            <option value="Intrigue_court_1">Intrigue Court 1</option>
            <option value="Intrigue_court_2">Intrigue Court 2</option>
            <option value="Scholarly_court_1">Scholarly Court 1</option>
            <option value="Scholarly_court_2">Scholarly Court 2</option>
        </select>
        <button onclick="addEducationTrait()">Add Education Trait</button>
        <button onclick="addCourtTrait()">Add Court Trait</button>

        <h3>Added Traits:</h3>
        <div id="added-traits"></div>
    </div>

    <h2>Personalities</h2>
    <div class="personality-container">
        <label for="personality-select">Add Personality:</label>
        <select id="personality-select">
            <option value="">Select Personality</option>
            <option value="Lustful">Lustful</option>
            <option value="Chaste">Chaste</option>
            <option value="Gluttonous">Gluttonous</option>
            <option value="Temperate">Temperate</option>
            <option value="Greedy">Generous</option>
            <option value="Lazy">Lazy</option>
            <option value="Diligent">Diligent</option>
            <option value="Wrathful">Wrathful</option>
            <option value="Calm">Calm</option>
            <option value="Patient">Patient</option>
            <option value="Impatient">Impatient</option>
            <option value="Arrogant">Arrogant</option>
            <option value="Humble">Humble</option>
            <option value="Deceitful">Deceitful</option>
            <option value="Honest">Honest</option>
            <option value="Craven">Craven</option>
            <option value="Brave">Brave</option>
            <option value="Shy">Shy</option>
            <option value="Gregarious">Gregarious</option>
            <option value="Ambitious">Ambitious</option>
            <option value="Content">Content</option>
            <option value="Arbitrary">Arbitrary</option>
            <option value="Just">Just</option>
            <option value="Cynical">Cynical</option>
            <option value="Zealous">Zealous</option>
            <option value="Paranoid">Paranoid</option>
            <option value="Trusting">Trusting</option>
            <option value="Compassionate">Compassionate</option>
            <option value="Callous">Callous</option>
            <option value="Sadistic">Sadistic</option>
            <option value="Stubborn">Stubborn</option>
            <option value="Fickle">Fickle</option>
            <option value="Vengeful">Vengeful</option>
            <option value="Forgiving">Forgiving</option>
            <option value="Eccentric">Eccentric</option>
        </select>
        <button onclick="addPersonality()">Add</button>

        <div class="personality-pool" id="personality-pool">
            <!-- Selected personalities will appear here -->
        </div>
    </div>

    <h2>Parent Selection:</h2>
    <label for="fatherSelect" class="character-select">Father:</label>
    <select id="fatherSelect">
        <option value="">Select Father</option>
    </select>

    <label for="motherSelect" class="character-select">Mother:</label>
    <select id="motherSelect">
        <option value="">Select Mother</option>
    </select>

    <h2>Birth Info:</h2>
    <div>
        <label class="date-label">Birth Year:</label>
        <input type="number" class="date-box" id="birthYear" placeholder="Year" required>
        <label class="date-label">Birth Month:</label>
        <input type="number" class="date-box" id="birthMonth" placeholder="Month" min="1" max="12" required>
        <label class="date-label">Birth Day:</label>
        <input type="number" class="date-box" id="birthDay" placeholder="Day" min="1" max="31" required>
    </div>

    <h2>Death Info:</h2>
    <div>
        <label class="date-label">Death Year:</label>
        <input type="number" class="date-box" id="deathYear" placeholder="Year">
        <label class="date-label">Death Month:</label>
        <input type="number" class="date-box" id="deathMonth" placeholder="Month" min="1" max="12">
        <label class="date-label">Death Day:</label>
        <input type="number" class="date-box" id="deathDay" placeholder="Day" min="1" max="31">
    </div>

    <button onclick="addCharacter()">Add Character</button>
    <button onclick="copyToClipboard()">Copy to Clipboard</button>

    <h2>Generated Character Data:</h2>
    <pre id="output"></pre>

    <script>
        const personalityConflicts = {
            'Lustful': 'Chaste',
            'Chaste': 'Lustful',
            'Gluttonous': 'Temperate',
            'Temperate': 'Gluttonous',
            'Greedy': 'Generous',
            'Generous': 'Greedy',
            'Lazy': 'Diligent',
            'Diligent': 'Lazy',
            'Wrathful': 'Calm',
            'Calm': 'Wrathful',
            'Patient': 'Impatient',
            'Impatient': 'Patient',
            'Arrogant': 'Humble',
            'Humble': 'Arrogant',
            'Deceitful': 'Honest',
            'Honest': 'Deceitful',
            'Craven': 'Brave',
            'Brave': 'Craven',
            'Shy': 'Gregarious',
            'Gregarious': 'Shy',
            'Ambitious': 'Content',
            'Content': 'Ambitious',
            'Arbitrary': 'Just',
            'Just': 'Arbitrary',
            'Cynical': 'Zealous',
            'Zealous': 'Cynical',
            'Paranoid': 'Trusting',
            'Trusting': 'Paranoid',
            'Compassionate': 'Callous',
            'Callous': 'Compassionate',
            'Sadistic': 'Forgiving',
            'Forgiving': 'Sadistic',
            'Stubborn': 'Fickle',
            'Fickle': 'Stubborn',
            'Vengeful': 'Forgiving',
            'Forgiving': 'Vengeful'
        };

        let characterData = '';
        let namespace = '';
        let characters = [];
        let characterIdCounter = 1; // Start ID counter at 1

        document.getElementById('namespace').addEventListener('change', function() {
            namespace = this.value.trim();
        });

        function moveFocus(event, nextId) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent form submission
                document.getElementById(nextId).focus();
            }
        }

        document.querySelectorAll('.collapsible').forEach(button => {
            button.addEventListener('click', function() {
                this.classList.toggle("active");
                const content = this.nextElementSibling;
                if (content.style.display === "block") {
                    content.style.display = "none";
                } else {
                    content.style.display = "block";
                }
            });
        });

        function addPersonality() {
            const selectElement = document.getElementById('personality-select');
            const selectedValue = selectElement.value;
            if (!selectedValue) return;

            console.log(`Adding personality: ${selectedValue}`);

            const pool = document.getElementById('personality-pool');
            const personalityItem = document.createElement('div');
            personalityItem.classList.add('personality-item');
            personalityItem.textContent = selectedValue;

            const removeButton = document.createElement('span');
            removeButton.classList.add('remove');
            removeButton.textContent = 'x';
            removeButton.onclick = function() {
                personalityItem.remove();
                updatePersonalityOptions();
            };

            personalityItem.appendChild(removeButton);
            pool.appendChild(personalityItem);

            selectElement.value = '';
            updatePersonalityOptions();
        }

        function updatePersonalityOptions() {
            const selectedPersonalities = Array.from(document.querySelectorAll('.personality-item')).map(item => item.textContent.replace('x', '').trim());
            console.log(`Selected personalities: ${selectedPersonalities}`);
            document.querySelectorAll('#personality-select option').forEach(option => {
                option.disabled = selectedPersonalities.includes(personalityConflicts[option.value]);
            });
        }     
        function addEducationTrait() {
            const selectElement = document.getElementById('education-traits');
            const selectedValue = selectElement.value;
            if (!selectedValue) return;

            console.log(`Adding education trait: ${selectedValue}`);

            const addedTraitsContainer = document.getElementById('added-traits');

            // Remove existing education trait if any
            const existingEducationTrait = addedTraitsContainer.querySelector('[data-trait-type="education"]');
            if (existingEducationTrait) {
            addedTraitsContainer.removeChild(existingEducationTrait);
            }

            const traitItem = document.createElement('div');
            traitItem.className = 'personality-item';
            traitItem.textContent = selectedValue;
            traitItem.dataset.traitType = 'education';

            const removeButton = document.createElement('span');
            removeButton.className = 'remove';
            removeButton.textContent = 'x';
            removeButton.onclick = function() {
            addedTraitsContainer.removeChild(traitItem);
            };

            traitItem.appendChild(removeButton);
            addedTraitsContainer.appendChild(traitItem);

            selectElement.value = ''; // Reset the dropdown
        }

        function addCourtTrait() {
            const selectElement = document.getElementById('court-traits');
            const selectedValue = selectElement.value;
            if (!selectedValue) return;

            console.log(`Adding court trait: ${selectedValue}`);

            const addedTraitsContainer = document.getElementById('added-traits');

            // Remove existing court trait if any
            const existingCourtTrait = addedTraitsContainer.querySelector('[data-trait-type="court"]');
            if (existingCourtTrait) {
                addedTraitsContainer.removeChild(existingCourtTrait);
            }

            const traitItem = document.createElement('div');
            traitItem.className = 'personality-item';
            traitItem.textContent = selectedValue;
            traitItem.dataset.traitType = 'court';

            const removeButton = document.createElement('span');
            removeButton.className = 'remove';
            removeButton.textContent = 'x';
            removeButton.onclick = function() {
                addedTraitsContainer.removeChild(traitItem);
            };

            traitItem.appendChild(removeButton);
            addedTraitsContainer.appendChild(traitItem);

            selectElement.value = ''; // Reset the dropdown
        }
        
        function addCharacter() {
            const name = document.getElementById('name').value.trim();
            const female = document.getElementById('female').value;
            const father = document.getElementById('fatherSelect').value;
            const mother = document.getElementById('motherSelect').value;

            console.log(`Adding character: ${name}, Female: ${female}, Father: ${father}, Mother: ${mother}`);

            // Get birth date
            const birthYear = document.getElementById('birthYear').value.trim();
            const birthMonth = Math.min(document.getElementById('birthMonth').value.trim(), 12);
            const birthDay = Math.min(document.getElementById('birthDay').value.trim(), 31);

            // Get death date
            const deathYear = document.getElementById('deathYear').value.trim();
            const deathMonth = Math.min(document.getElementById('deathMonth').value.trim(), 12);
            const deathDay = Math.min(document.getElementById('deathDay').value.trim(), 31);

            console.log(`Birth Date: ${birthYear}-${birthMonth}-${birthDay}, Death Date: ${deathYear}-${deathMonth}-${deathDay}`);

            // Get selected traits
            const selectedTraits = new Set(Array.from(document.querySelectorAll('#added-traits .personality-item')).map(item => item.textContent.replace('x', '').trim()));
            const selectedPersonalities = new Set(Array.from(document.querySelectorAll('#personality-pool .personality-item')).map(item => item.textContent.replace('x', '').trim()));

            console.log(`Selected Traits: ${Array.from(selectedTraits)}, Selected Personalities: ${Array.from(selectedPersonalities)}`);

            // Create character entry with incremented ID
            let characterEntry = `${namespace}_${characterIdCounter} = {\n`;
            characterEntry += `  name = "${name}"\n`;
            characterEntry += `  female = ${female}\n`;
            characterEntry += `  dynasty = ${document.getElementById('dynasty').value.trim()}\n`;
            characterEntry += `  religion = ${document.getElementById('religion').value.trim()}\n`;
            characterEntry += `  culture = ${document.getElementById('culture').value.trim()}\n`;

            // Add traits
            selectedTraits.forEach(trait => {
                characterEntry += `  add_trait = ${trait}\n`;
            });

            // Add personalities
            selectedPersonalities.forEach(personality => {
                characterEntry += `  add_trait = ${personality}\n`;
            });

            if (father) {
                characterEntry += `  father = ${father}\n`;
            }
            if (mother) {
                characterEntry += `  mother = ${mother}\n`;
            }

            characterEntry += `  ${birthYear}.${birthMonth}.${birthDay} = {\n`;
            characterEntry += `    birth = yes\n`;
            characterEntry += `  }\n`;
            if (deathYear && deathMonth && deathDay) {
                characterEntry += `  ${deathYear}.${deathMonth}.${deathDay} = {\n`;
                characterEntry += `    death = yes\n`;
            characterEntry += `  }\n`;
            }
            characterEntry += `}\n\n`;

            characterData += characterEntry;
            characters.push({ name, female, id: `${namespace}_${characterIdCounter}`, father, mother, birthYear, deathYear }); // Store character for parent selection
            updateParentOptions();
            document.getElementById('output').textContent = characterData;

            // Increment the character ID counter for the next character
            characterIdCounter++;

            // Clear input fields after adding the character
            clearInputFields();
        }

        function clearInputFields() {
            console.log('Clearing input fields');
            document.getElementById('name').value = '';
            document.getElementById('fatherSelect').value = '';
            document.getElementById('motherSelect').value = '';
            document.getElementById('birthYear').value = '';
            document.getElementById('birthMonth').value = '';
            document.getElementById('birthDay').value = '';
            document.getElementById('deathYear').value = '';
            document.getElementById('deathMonth').value = '';
            document.getElementById('deathDay').value = '';
            document.getElementById('personality-select').value = '';
            document.getElementById('personality-pool').innerHTML = '';
            document.getElementById('added-traits').innerHTML = '';
        }

        function updateParentOptions() {
            console.log('Updating parent options');
            const fatherSelect = document.getElementById('fatherSelect');
            const motherSelect = document.getElementById('motherSelect');

            fatherSelect.innerHTML = '<option value="">Select Father</option>'; // Reset options
            motherSelect.innerHTML = '<option value="">Select Mother</option>'; // Reset options

            characters.forEach(character => {
                const option = new Option(character.name, `${namespace}_${character.id}`);
                if (character.female === "no") { // Male character
                    fatherSelect.add(option);
                } else { // Female character
                    motherSelect.add(option);
                }
            });
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(characterData).then(() => {
                console.log('Character data copied to clipboard');
                alert('Character data copied to clipboard!');
            }).catch(err => {
                console.error('Could not copy text: ', err);
            });
        }

        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const formElements = Array.from(document.querySelectorAll('input, select, button'));
                    const index = formElements.indexOf(event.target);
                    let nextElement = formElements[index + 1];
                    while (nextElement && nextElement.closest('.content') && nextElement.closest('.content').style.display === 'none') {
                        nextElement = formElements[formElements.indexOf(nextElement) + 1];
                    }
                    if (nextElement) {
                        nextElement.focus();
                    }
                }
            });
        });

        document.getElementById('birthMonth').setAttribute('max', '12');
        document.getElementById('birthDay').setAttribute('max', '31');
        document.getElementById('deathMonth').setAttribute('max', '12');
        document.getElementById('deathDay').setAttribute('max', '31');

        document.getElementById('birthMonth').addEventListener('input', function() {
            if (this.value > 12) this.value = 12;
        });
        document.getElementById('birthDay').addEventListener('input', function() {
            if (this.value > 31) this.value = 31;
        });
        document.getElementById('deathMonth').addEventListener('input', function() {
            if (this.value > 12) this.value = 12;
        });
        document.getElementById('deathDay').addEventListener('input', function() {
            if (this.value > 31) this.value = 31;
        });

        const cultures = [
            "akan", "guan", "kru", "bedouin", "egyptian", "maghrebi", "levantine", "yemeni", "latgalian", "lithuanian",
            "prussian", "estonian", "finnish", "karelian", "sami", "vepsian", "east bantu", "baranis", "butr", "guanche",
            "zaghawa", "breton", "cornish", "cumbrian", "pictish", "welsh", "burmese", "mon", "alan", "armenian", "georgian",
            "greek", "assyrian", "hausa", "kanuri", "nupe", "sao", "bavarian", "dutch", "franconian", "frisian", "german",
            "langobard", "saxon", "swabian", "han", "gond", "kannada", "tamil", "telugu", "daju", "ethiopian", "nubian",
            "welayta", "ilmenian", "russian", "severian", "volhynian", "frankish", "french", "norman", "occitan", "gaelic",
            "irish", "bobo", "gur", "malinke", "marka", "mel", "afar", "beja", "somali", "andalusian", "aragonese",
            "asturleonese", "basque", "castilian", "catalan", "galician", "portuguese", "suebi", "visigothic", "bengali",
            "brahui", "gujarati", "assamese", "hindustani", "kashmiri", "malvi", "marathi", "nepali", "oriya", "punjabi",
            "rajput", "sindhi", "sinhala", "afghan", "baloch", "daylamite", "khwarezmian", "kurdish", "persian", "saka",
            "sogdian", "tajik", "ashkenazi", "bavlim", "hebrew", "kochinim", "radhanite", "sephardi", "cisalpine", "italian",
            "lombard", "sardinian", "sicilian", "hungarian", "mogyer", "buryat", "jurchen", "kerait", "khitan", "mongol",
            "naiman", "oirat", "ongud", "tuyuhun", "edo", "ewe", "igbo", "yoruba", "danish", "norse", "norwegian", "swedish",
            "qiang", "tangut", "bozo", "gaw", "mossi", "songhai", "soninke", "sorko", "pulaar", "serer", "wolof", "bosnian",
            "bulgarian", "croatian", "serbian", "bodpa", "kirati", "lhomon", "sumpa", "tsangpa", "zhangzhung", "tocharian",
            "avar", "bashkir", "bolghar", "chuvash", "cuman", "karluk", "khazar", "kimek", "kipchak", "kirghiz", "laktan",
            "turkish", "pecheneg", "shatuo", "uriankhai", "uyghur", "yughur", "samoyed", "khanty", "komi", "vlach", "mari",
            "merya", "meshchera", "mordvin", "muroma", "anglo-saxon", "english", "old saxon", "scottish", "carantanian",
            "czech", "polabian", "polish", "pommeranian", "slovien", "ancient egyptian", "gothic", "hunnic", "macedonian",
            "roman", "trojan"
        ];

        document.getElementById('culture').addEventListener('input', function() {
            const input = this.value.toLowerCase();
            const suggestions = cultures.filter(culture => culture.startsWith(input));
            const suggestionsContainer = document.getElementById('culture-suggestions');
            suggestionsContainer.innerHTML = '';
            suggestions.forEach(suggestion => {
                const suggestionElement = document.createElement('div');
                suggestionElement.className = 'autocomplete-suggestion';
                suggestionElement.textContent = suggestion;
                suggestionElement.onclick = function() {
                    document.getElementById('culture').value = suggestion;
                    suggestionsContainer.innerHTML = '';
                };
                suggestionsContainer.appendChild(suggestionElement);
            });
        });

        document.getElementById('culture').addEventListener('keydown', function(event) {
            if (event.key === 'Tab') {
                const suggestionsContainer = document.getElementById('culture-suggestions');
                const firstSuggestion = suggestionsContainer.firstChild;
                if (firstSuggestion) {
                    this.value = firstSuggestion.textContent;
                    suggestionsContainer.innerHTML = '';
                    event.preventDefault();
                }
            }
        });

    </script>

</body>
</html>
